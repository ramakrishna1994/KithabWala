var module;UMD(module,{"minted:m":["M"],"minted:template":[],"minted:vendor/underscore-1.8.2.min":"_"})(this,function(m_module,m_template,_){var M=m_module.M;M.Template||(M.Template={});M.Template.DesignerStorefront||(M.Template.DesignerStorefront={});M.Template.DesignerStorefront.Fan=M.templateWrapper(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="";__p+='\n<div class="pill storefrontFan">\n  ';if(isFan){__p+='\n    <div class="pillLabel pillLabelRounded floatL inactive">\n      <h6>YOU\'RE A FAN</h6>\n      <img class="sprite fanIconActive"\n        src="'+((__t=M.img_src("/static/images/sprite_placeholder.png"))==null?"":__t)+'"/>\n    </div>\n  '}else{__p+='\n    <div class="pillLabel pillLabelRounded floatL">\n      <h6>BECOME A FAN</h6>\n      <img class="sprite fanIconInactive"\n        src="'+((__t=M.img_src("/static/images/sprite_placeholder.png"))==null?"":__t)+'"/>\n    </div>\n  '}__p+='\n  <div class="pillPointerWrap floatR">\n    <div class="pillPointerArrowLeft"></div>\n    <span class="pillPointer">'+((__t=M.html.htmlEscape(fanCount))==null?"":__t)+" FANS</span>\n  </div>\n</div>\n"}return __p});M.Template.DesignerStorefront.Popover=M.templateWrapper(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="";__p+='\n<iframe class="storefront-iframe" src="'+((__t=M.html.htmlEscape(src))==null?"":__t)+'"></iframe>\n<div class="loading"><div class="loading-message">loading...</div></div>\n'}return __p});M.Template.DesignerStorefront.PreviewBar=M.templateWrapper(function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{}){__p+="";__p+='\n<div id="statusContainer" class="floatL">\n  <span>\n    <img class="sprite checkmarkGreen16 '+((__t=M.html.htmlAttributeEscape(spriteClass))==null?"":__t)+'"\n    src="'+((__t=M.img_src("/static/images/sprite_placeholder.png"))==null?"":__t)+'"/>\n  </span>\n  <span class="previewMode upper '+((__t=M.html.htmlAttributeEscape(statusExtraClass))==null?"":__t)+'">\n    '+((__t=M.html.htmlAttributeEscape(statusText))==null?"":__t)+'\n  </span>\n</div>\n<div class="floatR buttonGroup">\n  <div id="secondaryButtonContainer" class="floatR buttonContainer"></div>\n  <div id="makeChangesButtonContainer" class="floatR buttonContainer"></div>\n</div>\n'}return __p});return{}});var module;UMD(module,{"minted:m":["M"],"minted:vendor/jquery-1.9.1.min":"$"})(this,function(e,t){var i=e.M;i.html={};i.html.htmlEscape=function(e){if(e){e=t("<div/>").text(e).html()}return e};i.html.htmlAttributeEscape=function(e){if(e){e=i.html.htmlEscape(e).replace(/'/g,"&#39;").replace(/"/g,"&quot;")}return e};i.html.unicodeStripControlCharacters=function(e){if(e){var t=new RegExp("[\x00-  -​-"+"  ᠎\u2028\u2029  　\ufeff]+","g");return e.replace(t," ")}return""};return{}});M.View=M.View||{};M.View.DesignerStorefront=M.View.DesignerStorefront||{};(function(e,t,i,n){"use strict";var r=960;var o=33;var s=null;var a=window.location.href;var l=window.location.pathname;var c=false;e.View.DesignerStorefront.Popover=n.View.extend({template:e.Template.DesignerStorefront.Popover,initialize:function(){this.$el=i(this.el);t.bindAll(this,"_resizeDialog","_iframeLoad","openDialog","closeDialog");i(window).bind("resize",this._resizeDialog)},render:function(){this.renderDialog();if(!this.$elClose){this.renderCloseButton()}this._resizeDialog();return this},renderDialog:function(){var e=this;this.$el.html(this.template({src:this.iframeSrc()}));this.$el.dialog({autoOpen:true,modal:true,width:960,minHeight:0,resizable:false,draggable:false,dialogClass:"ui-dialog-full-width ui-dialog-designer-storefront",position:{my:"center top",at:"center top",of:window},open:this.openDialog,close:this.closeDialog});this.$elParent=this.$el.parents(".ui-dialog-designer-storefront");this.$elOverlay=this.$elParent.next(".ui-widget-overlay");if(!this.$elOverlay.length){this.$elOverlay=this.$elParent.prev(".ui-widget-overlay")}this.$elOverlay.css({"background-color":"#999","z-index":this._getDialogZIndex()-1});this.$elOverlay.click(function(){e.$el.dialog("close")});this.$iframe=this.$el.find("iframe");this.$iframe.load(this._iframeLoad)},renderCloseButton:function(){var e=this;this.$elClose=i('<div class="closeButtonWrap">').css({padding:"10px","background-color":"#FFF",position:"fixed","z-index":this._getDialogZIndex()+1,top:"0px",right:"20px","box-shadow":"0 0 2px #999",cursor:"pointer"});this.$elClose.append(i('<div class="ui-dialog-titlebar-close-storefront"></div>'));this.$elParent.after(this.$elClose);this.$elClose.click(function(){e.$el.dialog("close")})},openDialog:function(){i("body").css("overflow","hidden")},closeDialog:function(){this.$el.remove();this.$elClose.remove();i("body").css("overflow","");s=null;if(this.historyIndex&&!c){window.history.go(-this.historyIndex)}i("title").text(this.options.title)},iframeSrc:function(){var e=new URI(this.options.url);return e.setSearch("t",Date.now()).resource()},pushStateSrc:function(){var e=new URI(this.options.url),t=e.segment();if(t[0]==="store"&&t[1]==="o"){e.segment(1,"")}return e.resource()},_iframeLoad:function(){this.$iframe.fadeIn(500);this.$el.find(".loading").remove();if(this.$iframe[0].contentWindow.$){this.$iframe[0].contentWindow.$("body").css("overflow-x","hidden")}this.updateHistoryIndex(c);this.constructor.pushOrReplaceState();this._resizeDialog()},_resizeDialog:t.debounce(function(){if(!this.$el||!this.$el.length){return}var e=Math.floor((i("body").outerWidth()-r)/2);if(e<0){e=0}this.$elParent.css("left",e);this.$el.height(i(window).height())},o),updateHistoryIndex:function(e){if(e&&window.history.state&&window.history.state.historyIndex){this.historyIndex=window.history.state.historyIndex}else if(e||!this.historyIndex){this.historyIndex=1}else{this.historyIndex++}},_getDialogZIndex:function(){return parseInt(this.$elParent.css("z-index"),10)},getIframeTitle:function(){return this.$iframe[0].contentWindow.$("title").text()},getHistoryStateObject:function(){return{src:this.options.url,historyIndex:this.historyIndex,title:this.getIframeTitle(),isOverlayPopStateEvent:true}}},{isNotOverlay:function(){return!!(e.IS_MOBILE||e.IS_TABLET||e.IS_MOBILE_USER_AGENT)},setLocationAndRender:function(t){var i=e.View.DesignerStorefront.Popover.isNotOverlay(),n=e.View.DesignerStorefront.Popover.getStoreUrlMatch(t,i),r=this;if(!n.then||typeof n.then!=="function"){t=n;this.renderPopover(t,i)}else{n.then(function(e){e=JSON.parse(e);if(e.vanity_url){if(i){t="/store/"+encodeURIComponent(e.vanity_url)}else{t="/store/o/"+encodeURIComponent(e.vanity_url)}}r.renderPopover(t,i)})}},renderPopover:function(t,i){e.assert(t);if(i){window.location=t}else{s=this.createOrUpdate(t);s.render()}},createOrUpdate:function(t){if(e.View.DesignerStorefront.Popover._isStoreUrl(l)){return false}if(!s){s=new e.View.DesignerStorefront.Popover({url:t,title:i("title").text()})}else{s.options.url=t}return s},_isStoreUrl:function(e){return e.match(/\/store\//)!=null||e.match(/\/storefront\//)!=null},pushOrReplaceState:function(){var e;if(!c){e=s.getHistoryStateObject();window.history.pushState(e,e.title,s.pushStateSrc(e.src))}else{e=window.history.state;window.history.replaceState(e,e.title,s.pushStateSrc(e.src))}c=false;i("title").text(e.title)},frameBust:function(e){var i=window.history.state;window.history.replaceState(i,i.title,a);t.defer(function(){window.location=e})},handlePopState:function(t){c=true;if(!e.View.DesignerStorefront.Popover.isOverlayPopStateEvent(t)){if(s){s.$el.dialog("close")}else{}c=false}else{e.View.DesignerStorefront.Popover.setLocationAndRender(t.state.src)}return false},getStoreUrlMatch:function(n,r){var o=new URI(n),s=o.segment(),a;if(s[0]==="search"){a=o.search(true);var l;if(r){l="/store/"}else{l="/store/o/"}if(a.designerVanityUrl){return l+a.designerVanityUrl}if(a.designerID){var c=a.designerID.toString();return i.ajax({url:"/store/designer-transform-id/"+encodeURIComponent(c),async:false})}}else if(s[0]==="store"){if(s[1]!=="o"){if(e.String.isOnlyDigits(s[1])){return i.ajax({url:"/store/designer-transform-id/"+encodeURIComponent(s[1]),async:false})}if(r){o.segment([s[0],t.rest(s,1)])}else{o.segment([s[0],"o",t.rest(s,1)])}}else{if(e.String.isOnlyDigits(s[2])){return i.ajax({url:"/store/designer-transform-id/"+encodeURIComponent(s[1]),async:false})}else{return o.resource()}}}return n},isOverlayPopStateEvent:function(e){return!!(e&&e.state&&e.state.isOverlayPopStateEvent)}});window.onpopstate=e.View.DesignerStorefront.Popover.handlePopState})(M,_,$,Backbone);
//# sourceMappingURL=designer_popover.js.map